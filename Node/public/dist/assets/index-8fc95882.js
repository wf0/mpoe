import{_ as G,l as S,r as y,o as s,c as f,b as I,F as E,j as P,n as X,B as z,t as N,u as g,q as D,E as te,y as C,w as q,f as h,m as oe,a as B,i as A,v as L,d as T,e as H,C as le,z as ae,D as se,G as ie,g as j,x as U}from"./index-a6d16cd4.js";import{C as re}from"./index-2e9ccae3.js";import{c as ce}from"./share-dfafd80b.js";import{e as fe}from"./execcontent-0635da60.js";import{p as ue,u as de,g as pe}from"./index-904b0323.js";import"./index-93fa085a.js";const me=["onClick"],_e={__name:"filecontentmenu",emits:["putFileToRecycle","rename"],setup(Y,{expose:r,emit:w}){let i=S([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),p=y(!0),o=S({});const l=S({x:0,y:0,display:"none"});let x=y(0);const O=async(u,c)=>{let{username:a,userid:v}=JSON.parse(sessionStorage.getItem("user"));switch(c){case"shear":let m=ce(a,o.fileid,o.filename+"."+o.filesuffix);return fe(m),C.success("分享链接已复制到粘贴板");case"delete":if(!o.fileid)return;try{await te.confirm(`确认删除 ${o.filename+"."+o.filesuffix} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let{code:F,msg:b}=await ue({fileid:o.fileid,userid:v});if(F!==200)return C.error(b);C.success(b),w("putFileToRecycle",o.fileid)}catch{C.info("已取消")}return;case"rename":return w("rename",x.value)}},$=u=>{p.value=!u.className.includes("icon-24gf-folderOpen");let{fileid:c,filename:a,filesuffix:v,folderid:m}=u.dataset;o.fileid=c,o.folderid=m,o.filename=a,o.filesuffix=v;let F={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},b=i.find(V=>V.icon==="icon-24gf-folderOpen");p.value?b&&i.shift():b||i.unshift(F)};return r({showContentMenu:(u,c)=>{x.value=c;let{target:a}=u;$(a),l.x=a.offsetLeft+u.offsetX,l.y=a.offsetTop+u.offsetY,l.display="block"},hiddenContentMenu:()=>(l.display="none",x.value=0)}),(u,c)=>(s(),f("div",null,[I("div",{onContextmenu:c[0]||(c[0]=D(()=>{},["stop"])),class:"contentmenu",style:z({left:l.x+"px",top:l.y+"px",display:l.display})},[(s(!0),f(E,null,P(g(i),(a,v)=>(s(),f("div",{key:v,onClick:m=>O(m,a.command)},[I("i",{class:X(["iconfont",a.icon]),style:z({color:a.color})},null,6),I("span",null,N(a.name),1)],8,me))),128))],36)]))}},ge=G(_e,[["__scopeId","data-v-24c8c043"]]);const he=["onContextmenu"],ye={class:"pages-list"},xe={key:0,class:"pages-list-filesbread"},ve={class:"pages-list-files"},be=["onDblclick","onContextmenu"],ke=["data-fileid","data-filename","data-filesuffix"],Ce=["onDblclick"],we=["onDblclick"],Fe={__name:"index",setup(Y){var r=S([]);const w=y(null);let i=y(""),p=y(null),o=y(null),l=S([]),x=y("");q(()=>j.state.searchKeyWord,e=>x.value=e,{immediate:!1,deep:!0}),q(()=>j.state.topCreateData,e=>W(e),{immediate:!1,deep:!0});const O=(e,n)=>e==="docx"?"#0f90e3":e==="xlsx"?"#01a408":e==="pdf"?"#ea5454":e==="txt"?"rgba(0, 0, 0, 0.6)":e==="md"?"#5A96DB":n==="folder"?"#ffd153":"",$=e=>{c(r[e])},K=(e,n)=>{const{type:_}=n;switch(_){case"folder":J(n),h.replace({query:{folderid:n.folderid,fromPath:h.currentRoute.value.query.folderid}});break;case"word":h.push(`/word/${n.fileid}`);break;case"excel":h.push(`/excel/${n.fileid}`);break;case"markdown":h.push(`/edit/${n.fileid}`);break}},J=e=>{l.push({name:e.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(l))},u=()=>{l.pop(),h.replace({query:{folderid:h.currentRoute.value.query.fromPath}})},c=async e=>{r.forEach(n=>n.changeflag=!1),e.changeflag=!0,await U(),w.value[0].focus()},a=async()=>{let e="";if(r.forEach(n=>{n.changeflag&&(e=n.fileid,n.folderid,n.filename=i.value||n.filename,n.changeflag=!1)}),i.value){let n=e?await de({fileid:e,newfilename:i.value}):{code:0,msg:"暂未实现文件夹更新"};n.code===200?C.success(n.msg):C.error(n.msg)}i.value=""},v=()=>w.value[0].blur();let m=y(!1);const F=async e=>{m.value=!0,await U(),p.value.showContentMenu(e),o.value.hiddenContentMenu()},b=()=>{m.value=!1},V=()=>{p.value&&p.value.hiddenContentMenu(),o.value.hiddenContentMenu()},Q=(e,n)=>(o.value.showContentMenu(e,n),p.value&&p.value.hiddenContentMenu()),W=({name:e,id:n,type:_,suffix:d})=>{if(_==="folder")return r.push({type:"folder",foldername:e,folderid:n,icon:"icon-24gf-folderOpen"});let M={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel",docx:"icon-Word"};r.push({type:_,fileid:n,filename:e,filesuffix:d,suffix:d,icon:M[d]})},Z=e=>{r.splice(r.findIndex(n=>n.fileid===e),1)},ee=e=>{e.folderid&&(e.type="folder",e.icon="icon-24gf-folderOpen"),e.filesuffix==="md"&&(e.type="markdown",e.icon="icon-file-markdown1"),e.filesuffix==="txt"&&(e.type="txt",e.icon="icon-wenben1"),e.filesuffix==="xlsx"&&(e.type="excel",e.icon="icon-excel"),e.filesuffix==="docx"&&(e.type="word",e.icon="icon-Word"),e.suffix=e.filesuffix};return q(h.currentRoute,async e=>{if(e.path!="/home/pages")return;r.length=0;let{userid:n}=JSON.parse(sessionStorage.getItem("user")),{folderid:_}=e.query;_||(l.length=0,sessionStorage.setItem("pagelistbread",[]));let d=await pe({userid:n,folderid:_});if(d.code!==200)return C.error(d.msg);d.data.length&&d.data.forEach(M=>{ee(M),r.push(M)})},{immediate:!0,deep:!0}),oe(()=>{let e=sessionStorage.getItem("pagelistbread");e&&JSON.parse(e).forEach(n=>l.push(n))}),(e,n)=>{const _=B("el-icon"),d=B("el-breadcrumb-item"),M=B("el-breadcrumb"),ne=B("el-input");return s(),f("div",{class:"pages",onClick:V,onContextmenu:D(F,["prevent","stop"])},[g(m)?(s(),A(re,{key:0,ref_key:"contentmenuRef",ref:p,onCreate:W,onClose:b},null,512)):L("",!0),T(ge,{ref_key:"filecontentmenuRef",ref:o,onPutFileToRecycle:Z,onRename:$},null,512),I("div",ye,[g(l).length?(s(),f("div",xe,[T(_,{onClick:u},{default:H(()=>[T(g(le))]),_:1}),T(M,{separator:"/"},{default:H(()=>[(s(!0),f(E,null,P(g(l),(t,R)=>(s(),A(d,{key:R},{default:H(()=>[ae(N(t.name),1)]),_:2},1024))),128))]),_:1})])):L("",!0),I("div",ve,[(s(!0),f(E,null,P(g(r).filter(t=>!g(x)||(t.filename||t.foldername).includes(g(x))),(t,R)=>(s(),f("div",{onDblclick:k=>K(R,t),onContextmenu:D(k=>Q(k,R),["prevent","stop"]),class:"pages-list-files-item",key:R},[I("i",{"data-fileid":t.fileid,"data-filename":t.filename,"data-filesuffix":t.suffix||t.filesuffix,class:X(["iconfont",t.icon]),style:z({color:O(t.suffix,t.type)})},null,14,ke),t.changeflag?(s(),A(ne,{key:1,ref_for:!0,ref_key:"inputRef",ref:w,onBlur:a,onKeydown:se(v,["enter"]),modelValue:g(i),"onUpdate:modelValue":n[0]||(n[0]=k=>ie(i)?i.value=k:i=k)},null,8,["onKeydown","modelValue"])):(s(),f(E,{key:0},[t.type==="folder"?(s(),f("span",{key:0,onDblclick:D(k=>c(t),["stop"])},N(t.foldername),41,Ce)):(s(),f("span",{key:1,onDblclick:D(k=>c(t),["stop"])},N(t.filename+"."+t.suffix),41,we))],64))],40,be))),128))])])],40,he)}}},Te=G(Fe,[["__scopeId","data-v-0e5cb68b"]]);export{Te as default};
