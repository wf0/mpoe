import{_ as L,w as P,m as Q,B as oe,a as D,v as K,l as F,r as h,o as i,c as f,b as I,F as $,j as J,n as Z,C as j,t as q,u as d,q as N,d as O,y as A,f as w,i as T,e as z,D as le,z as ae,G as se,H as ie,g as Y,x as G}from"./index-88b77b73.js";import{C as re}from"./index-c552d484.js";import{c as ce}from"./shear-29e30aa9.js";import{e as fe}from"./execcontent-0635da60.js";import"./index-e172cf3e.js";import{u as ue,g as de}from"./index-ec82be82.js";const pe={__name:"recycleAnimation",props:{recyclePosition:{type:Object,default:()=>{}}},setup(B){const{recyclePosition:l}=B;return P(l,()=>{console.log(l)},{immediate:!1,deep:!0}),Q(()=>{let p=oe();const o=document.querySelector("body");o.append?o.append(p.ctx.$el):o.appendChild(p.ctx.$el)}),(p,o)=>(D("el-badge"),K("",!0))}},me=L(pe,[["__scopeId","data-v-d689fe12"]]);const _e=["onClick"],ye={__name:"filecontentmenu",emits:["putFileToRecycle","rename"],setup(B,{expose:l,emit:p}){let o=F([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),m=h(!0),c=F({});const a=F({x:0,y:0,display:"none"});let y=F({x:0,y:0,show:!1}),M=h(0);const E=async(r,u)=>{let{username:s,userid:g}=JSON.parse(sessionStorage.getItem("user"));switch(u){case"shear":let x=ce(s,c.fileid,c.filename+"."+c.filesuffix);return fe(x),A.success("分享链接已复制到粘贴板");case"delete":let{clientX:R,clientY:C}=r;y.x=R,y.y=C,y.show=!0;return;case"rename":return p("rename",M.value)}},V=r=>{m.value=!r.className.includes("icon-24gf-folderOpen");let{fileid:u,filename:s,filesuffix:g,folderid:x}=r.dataset;c.fileid=u,c.folderid=x,c.filename=s,c.filesuffix=g;let R={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},C=o.find(H=>H.icon==="icon-24gf-folderOpen");m.value?C&&o.shift():C||o.unshift(R)};return l({showContentMenu:(r,u)=>{M.value=u;let{target:s}=r;V(s),a.x=s.offsetLeft+r.offsetX,a.y=s.offsetTop+r.offsetY,a.display="block"},hiddenContentMenu:()=>(a.display="none",M.value=0)}),(r,u)=>(i(),f("div",null,[I("div",{onContextmenu:u[0]||(u[0]=N(()=>{},["stop"])),class:"contentmenu",style:j({left:a.x+"px",top:a.y+"px",display:a.display})},[(i(!0),f($,null,J(d(o),(s,g)=>(i(),f("div",{key:g,onClick:x=>E(x,s.command)},[I("i",{class:Z(["iconfont",s.icon]),style:j({color:s.color})},null,6),I("span",null,q(s.name),1)],8,_e))),128))],36),O(me,{recyclePosition:d(y)},null,8,["recyclePosition"])]))}},ge=L(ye,[["__scopeId","data-v-b0bd5392"]]);const he=["onContextmenu"],xe={class:"pages-list"},ve={key:0,class:"pages-list-filesbread"},be={class:"pages-list-files"},Ce=["onDblclick","onContextmenu"],ke=["data-fileid","data-filename","data-filesuffix"],we=["onDblclick"],Fe=["onDblclick"],Ie={__name:"index",setup(B){var l=F([]);const p=h(null);let o=h(""),m=h(null),c=h(null),a=F([]),y=h("");P(()=>Y.state.searchKeyWord,e=>y.value=e,{immediate:!1,deep:!0}),P(()=>Y.state.topCreateData,e=>X(e),{immediate:!1,deep:!0});const M=(e,n)=>e==="word"?"#0f90e3":e==="xlsx"?"#01a408":e==="pdf"?"#ea5454":e==="txt"?"rgba(0, 0, 0, 0.6)":e==="md"?"#5A96DB":n==="folder"?"#ffd153":"",E=e=>{r(l[e])},V=(e,n)=>{if(n.type==="folder")return U(n),w.replace({query:{folderid:n.folderid,fromPath:w.currentRoute.value.query.folderid}});w.push({path:n.filesuffix==="xlsx"?`/excel/${n.fileid}`:`/edit/${n.fileid}`,query:n})},U=e=>{a.push({name:e.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(a))},W=()=>{a.pop(),w.replace({query:{folderid:w.currentRoute.value.query.fromPath}})},r=async e=>{l.forEach(n=>n.changeflag=!1),e.changeflag=!0,await G(),p.value[0].focus()},u=async()=>{let e="";if(l.forEach(n=>{n.changeflag&&(e=n.fileid,n.folderid,n.filename=o.value||n.filename,n.changeflag=!1)}),o.value){let n=e?await ue({fileid:e,newfilename:o.value}):{code:0,msg:"暂未实现文件夹更新"};n.code===200?A.success(n.msg):A.error(n.msg)}o.value=""},s=()=>p.value[0].blur();let g=h(!1);const x=async e=>{g.value=!0,await G(),m.value.showContentMenu(e),c.value.hiddenContentMenu()},R=()=>{g.value=!1},C=()=>{m.value&&m.value.hiddenContentMenu(),c.value.hiddenContentMenu()},H=(e,n)=>(c.value.showContentMenu(e,n),m.value&&m.value.hiddenContentMenu()),X=({name:e,id:n,type:v,suffix:_})=>{if(v==="folder")return l.push({type:"folder",foldername:e,folderid:n,icon:"icon-24gf-folderOpen"});let k={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel"};l.push({type:v,fileid:n,filename:e,suffix:_,icon:k[_]})},ee=e=>{l.splice(l.findIndex(n=>n.fileid===e),1)},ne=e=>{e.folderid&&(e.type="folder",e.icon="icon-24gf-folderOpen"),e.filesuffix==="md"&&(e.type="markdown",e.icon="icon-file-markdown1"),e.filesuffix==="txt"&&(e.type="txt",e.icon="icon-wenben1"),e.filesuffix==="xlsx"&&(e.type="excel",e.icon="icon-excel"),e.suffix=e.filesuffix};return P(w.currentRoute,async e=>{if(e.path!="/home/pages")return;l.length=0;let{userid:n}=JSON.parse(sessionStorage.getItem("user")),{folderid:v}=e.query;v||(a.length=0,sessionStorage.setItem("pagelistbread",[]));let _=await de({userid:n,folderid:v});if(_.code!==200)return A.error(_.msg);_.data.length&&_.data.forEach(k=>{ne(k),l.push(k)})},{immediate:!0,deep:!0}),Q(()=>{let e=sessionStorage.getItem("pagelistbread");e&&JSON.parse(e).forEach(n=>a.push(n))}),(e,n)=>{const v=D("el-icon"),_=D("el-breadcrumb-item"),k=D("el-breadcrumb"),te=D("el-input");return i(),f("div",{class:"pages",onClick:C,onContextmenu:N(x,["prevent","stop"])},[d(g)?(i(),T(re,{key:0,ref_key:"contentmenuRef",ref:m,onCreate:X,onClose:R},null,512)):K("",!0),O(ge,{ref_key:"filecontentmenuRef",ref:c,onPutFileToRecycle:ee,onRename:E},null,512),I("div",xe,[d(a).length?(i(),f("div",ve,[O(v,{onClick:W},{default:z(()=>[O(d(le))]),_:1}),O(k,{separator:"/"},{default:z(()=>[(i(!0),f($,null,J(d(a),(t,S)=>(i(),T(_,{key:S},{default:z(()=>[ae(q(t.name),1)]),_:2},1024))),128))]),_:1})])):K("",!0),I("div",be,[(i(!0),f($,null,J(d(l).filter(t=>!d(y)||(t.filename||t.foldername).includes(d(y))),(t,S)=>(i(),f("div",{onDblclick:b=>V(S,t),onContextmenu:N(b=>H(b,S),["prevent","stop"]),class:"pages-list-files-item",key:S},[I("i",{"data-fileid":t.fileid,"data-filename":t.filename,"data-filesuffix":t.suffix||t.filesuffix,class:Z(["iconfont",t.icon]),style:j({color:M(t.suffix,t.type)})},null,14,ke),t.changeflag?(i(),T(te,{key:1,ref_for:!0,ref_key:"inputRef",ref:p,onBlur:u,onKeydown:se(s,["enter"]),modelValue:d(o),"onUpdate:modelValue":n[0]||(n[0]=b=>ie(o)?o.value=b:o=b)},null,8,["onKeydown","modelValue"])):(i(),f($,{key:0},[t.type==="folder"?(i(),f("span",{key:0,onDblclick:N(b=>r(t),["stop"])},q(t.foldername),41,we)):(i(),f("span",{key:1,onDblclick:N(b=>r(t),["stop"])},q(t.filename+"."+t.suffix),41,Fe))],64))],40,Ce))),128))])])],40,he)}}},Pe=L(Ie,[["__scopeId","data-v-2044bbea"]]);export{Pe as default};
