import{_ as B,r as x,w as D,a as h,o as m,c as M,b as e,d,e as u,u as v,s as ee,n as R,f as C,g as H,p as P,h as K,i as z,F as U,j as W,t as E,k as te,l as A,m as ne,q as F,v as J,x as oe,E as L,y as I,z as se,A as ae}from"./index-8a376891.js";import{C as ie}from"./index-a25a8400.js";import{s as le,c as ce}from"./index-c0bfc84b.js";import"./index-091ed95d.js";const f=n=>(P("data-v-c389d181"),n=n(),K(),n),re={class:"aside"},de=f(()=>e("div",{class:"aside-logo"},[e("i",{class:"iconfont icon-circulation"}),e("span",{title:"多人协作编辑器"}," 多人协作编辑器 ")],-1)),ue={class:"aside-search"},_e=f(()=>e("i",{class:"iconfont icon-shouye-zhihui"},null,-1)),pe=f(()=>e("span",null," 首页 ",-1)),me=[_e,pe],he=f(()=>e("i",{class:"iconfont icon-zuijinchangyong"},null,-1)),fe=f(()=>e("span",null," 最近文档 ",-1)),ge=[he,fe],ve=f(()=>e("i",{class:"iconfont icon-shujugongxiang"},null,-1)),ye=f(()=>e("span",null," 与我共享 ",-1)),we=[ve,ye],xe=f(()=>e("i",{class:"iconfont icon-shoucang2"},null,-1)),Ce=f(()=>e("span",null," 我的收藏 ",-1)),$e=[xe,Ce],ke=f(()=>e("i",{class:"iconfont icon-huishouzhan"},null,-1)),be=f(()=>e("span",null," 回收站 ",-1)),Me=[ke,be],Se={__name:"aside",props:{activeMenu:{type:String,default:"pages"}},setup(n){const s=x("");D(s,o=>H.commit("setSearchKeyWord",o));const l=o=>C.push(`/home/${o}`);return(o,t)=>{const c=h("el-icon"),r=h("el-input");return m(),M("div",re,[de,e("div",ue,[d(r,{placeholder:"搜索",modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),clearable:""},{prefix:u(()=>[d(c,null,{default:u(()=>[d(v(ee))]),_:1})]),_:1},8,["modelValue"])]),e("div",{class:R(["aside-icon",{active:n.activeMenu==="pages"}]),onClick:t[1]||(t[1]=a=>l("pages"))},me,2),e("div",{class:R(["aside-icon",{active:n.activeMenu==="news"}]),onClick:t[2]||(t[2]=a=>l("news"))},ge,2),e("div",{class:R(["aside-icon",{active:n.activeMenu==="share"}]),onClick:t[3]||(t[3]=a=>l("share"))},we,2),e("div",{class:R(["aside-icon",{active:n.activeMenu==="favor"}]),onClick:t[4]||(t[4]=a=>l("favor"))},$e,2),e("div",{class:"aside-bottom",onClick:t[5]||(t[5]=a=>v(C).push("/recycle"))},Me)])}}},Ie=B(Se,[["__scopeId","data-v-c389d181"]]);const Te={style:{width:"100%",height:"100%"}},Re={class:"dropdownItem"},ze=["title"],Be={__name:"index",props:{trigger:{type:String,default:"click"},list:{type:Array,default:()=>[]}},emits:["handleCommand","handleOpen","handleClose"],setup(n,{emit:s}){const l=c=>s("handleCommand",c),o=()=>s("handleOpen"),t=()=>s("handleClose");return(c,r)=>{const a=h("el-dropdown-item"),w=h("el-dropdown-menu"),g=h("el-dropdown");return m(),z(g,{trigger:n.trigger,onHandleOpen:o,onHandleClose:t,onCommand:l},{dropdown:u(()=>[d(w,null,{default:u(()=>[(m(!0),M(U,null,W(n.list,_=>(m(),z(a,{key:_.command,command:_.command},{default:u(()=>[e("div",Re,[e("i",{class:R(["iconfont",_.icon])},null,2),e("span",{title:_.name},E(_.name),9,ze)])]),_:2},1032,["command"]))),128))]),_:1})]),default:u(()=>[e("div",Te,[te(c.$slots,"content",{},void 0,!0)])]),_:3},8,["trigger"])}}},Oe=B(Be,[["__scopeId","data-v-d3abf79c"]]),Ve=(n,s,l="Typora")=>new Promise((o,t)=>{if(n.name.split(".")[1]==="md"){let r=new FileReader;r.readAsText(n,"UTF-8"),r.onloadend=async a=>{a.target.readyState!==2&&t({msg:"文件读写失败"});let w=Ne(a.target.result.toString().split(`
`)),{userid:g}=JSON.parse(sessionStorage.getItem("user")),_=await le({fileid:s,userid:g,content:w});_.code!==200&&t(_),o(_)}}});function Ne(n,s){let l=[];return n.forEach(o=>{let t=o&&o.match(/^[#]+|[*]+[\u4e00-\u9fa5|\d|a-z|A-Z|-]|[~~~]{3}|[<][u][>]|[\]][(]/g);if(!t)return l.push({insert:j(o)});let c=null;t.forEach(r=>{r.toString().includes("#")&&(c=r.length)}),l.push({insert:j(o),attributes:{header:c}})}),JSON.stringify(l)}function j(n){return n.replace(/[']/g,"#[d]#").replace(/["]/g,"#[s]#").replace(/^#+/g,"")}const y=n=>(P("data-v-3565c743"),n=n(),K(),n),Fe={class:"top-left"},He=y(()=>e("i",{class:"iconfont icon-xinjian"},null,-1)),Ae=y(()=>e("span",null,"新建",-1)),Ee=y(()=>e("i",{class:"iconfont icon-daoru"},null,-1)),qe=y(()=>e("span",null,"导入",-1)),Je=y(()=>e("i",{class:"iconfont icon-duqumoban"},null,-1)),Le=y(()=>e("span",null,"模板",-1)),je=y(()=>e("i",{class:"iconfont icon-gongneng"},null,-1)),De=y(()=>e("span",null,"工具箱",-1)),Pe={class:"top-right"},Ke={class:"top-right-vip"},Ue=y(()=>e("i",{class:"iconfont icon-zuanshi"},null,-1)),We={class:"top-right-message",style:{"margin-right":"20px"}},Ze=y(()=>e("i",{class:"iconfont icon-xiaoxizhongxin"},null,-1)),Ge={class:"top-right-user"},Qe=["innerHTML"],Xe={key:2,class:"iconfont icon-tipvip"},Ye={__name:"top",setup(n){const s=x("【双十一】超值活动，会员低至0.5元/天！");let l=x(!0),o=x("");const t=A([{name:"个人中心",command:"user",icon:"icon-zhanghao"},{name:"系统设置",command:"setting",icon:"icon-shezhi-xianxing"},{name:"项目地址",command:"gitee",icon:"icon-github-fill"},{name:"退出系统",command:"exit",icon:"icon-tuichu"}]),c=A({show:!1}),r=i=>{switch(i){case"user":C.push("/user");break;case"gitee":window.open("https://gitee.com/wfeng0/mpoe");break;case"setting":c.show=!0;break;case"exit":sessionStorage.clear(),C.push("/login");break}},a=()=>C.push("/template");let w=x(null),g=x(!1);const _=async i=>{g.value=!0,await oe(),w.value.showContentMenu(i,!0)},Z=()=>g.value=!1,G=i=>H.commit("setTopCreateData",i);let O=x(null);const Q=async i=>{const p=i.target.files[0];try{await L.confirm(`确认上传 ${p.name} 进行协同吗？`,"文件上传",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),X(p)}catch{I.info("已取消")}O.value.value=""},X=async i=>{let p=JSON.parse(localStorage.getItem("user")).userid,$=i.name.split(".")[0],k=i.name.split(".")[1],T=k==="md"?"markdown":"excel",V=C.currentRoute.value.query.folderid,b=Math.random().toString().split(".")[1].slice(0,3),S=await ce({userid:p,filename:b,filesuffix:k,filetype:T,fileownerfolderid:V});if(S.code!==200)return I.error("导入失败，"+S.msg);I.success("文件导入成功！");let Y={id:S.data,name:b,suffix:k,type:T};H.commit("setTopCreateData",Y);let N=await Ve(i,S.data,"Typora");if(N.code!==200)return I.error(N.msg);I.success(N.msg);try{await L.confirm("是否立即打开文件？","打开文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let q={filename:$,filesuffix:k,filetype:T,owner:p};C.push({path:k==="xlsx"?`/excel/${S.data}`:`/edit/${S.data}`,query:q})}catch{I.info("已取消")}};return ne(()=>{let i=JSON.parse(sessionStorage.getItem("user"));l.value=i.vip,o.value=i.userimg}),(i,p)=>{const $=h("el-button"),k=h("el-link"),T=h("el-badge"),V=h("el-avatar");return m(),M("div",{class:"top",onClick:p[2]||(p[2]=F((...b)=>i.hiddenContentMenu&&i.hiddenContentMenu(...b),["stop"]))},[e("div",Fe,[d($,{type:"primary",onClick:p[0]||(p[0]=F(b=>_(b),["stop"]))},{default:u(()=>[He,Ae]),_:1}),d($,{text:"",onClick:p[1]||(p[1]=F(b=>v(O).click(),["stop"]))},{default:u(()=>[Ee,qe]),_:1}),d($,{text:"",onClick:a},{default:u(()=>[Je,Le]),_:1}),d($,{text:""},{default:u(()=>[je,De]),_:1})]),e("div",Pe,[e("div",Ke,[d(k,{type:"danger"},{default:u(()=>[Ue,e("span",null,E(s.value),1)]),_:1})]),e("div",We,[d(T,{value:"",class:"item"},{default:u(()=>[Ze]),_:1})]),e("div",Ge,[d(Oe,{list:t,onCommand:r},{content:u(()=>[v(o)?(m(),M("div",{key:0,class:"userimg_svg",innerHTML:v(o)},null,8,Qe)):(m(),z(V,{key:1,shape:"square",src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"})),v(l)?(m(),M("i",Xe)):J("",!0)]),_:1},8,["list"])])]),v(g)?(m(),z(ie,{key:0,ref_key:"contentmenuRef",ref:w,onCreate:G,onClose:Z},null,512)):J("",!0),e("input",{type:"file",onChange:Q,style:{display:"none"},accept:"*",ref_key:"inputRef",ref:O},null,544)])}}},et=B(Ye,[["__scopeId","data-v-3565c743"]]);const tt={class:"home"},nt={class:"home-main"},ot={__name:"index",setup(n){let s=A([{title:"首页",path:"/home/pages"}]),l=[{path:"news",title:"最近文档"},{path:"share",title:"与我共享"},{path:"favor",title:"我的收藏"}],o=x("pages");return D(C.currentRoute,t=>{let c=t.path.split("/")[2];o=c;let r=l.find(a=>a.path===c);s.length===1&&c==="pages"||(s.length>1&&s.pop(),r&&s.push({title:r.title,path:`/home/${r.path}`}))},{deep:!0,immediate:!0}),(t,c)=>{const r=h("el-breadcrumb-item"),a=h("el-breadcrumb"),w=h("router-view");return m(),M("div",tt,[d(Ie,{activeMenu:v(o)},null,8,["activeMenu"]),e("div",nt,[d(et),d(a,{class:"home-main-bread","separator-icon":v(ae)},{default:u(()=>[(m(!0),M(U,null,W(v(s),(g,_)=>(m(),z(r,{key:_,to:{path:g.path}},{default:u(()=>[se(E(g.title),1)]),_:2},1032,["to"]))),128))]),_:1},8,["separator-icon"]),d(w,{style:{flex:"auto",padding:"10px 20px"}})])])}}},ct=B(ot,[["__scopeId","data-v-bc54465d"]]);export{ct as default};
