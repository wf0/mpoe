import{_ as L,w as P,m as Q,B as oe,a as D,v as K,l as F,r as g,o as i,c as u,b as I,F as q,j as J,n as Z,C as j,t as A,u as d,q as N,d as O,y as B,f as w,i as T,e as z,D as le,z as ae,G as se,H as ie,g as Y,x as G}from"./index-f4b1f9c1.js";import{C as re}from"./index-cdd8c00a.js";import{c as ce}from"./shear-113bed32.js";import{e as ue}from"./execcontent-0635da60.js";import"./index-14d71e9c.js";import{u as fe,g as de}from"./index-543ac961.js";const pe={__name:"recycleAnimation",props:{recyclePosition:{type:Object,default:()=>{}}},setup(E){const{recyclePosition:o}=E;return P(o,()=>{console.log(o)},{immediate:!1,deep:!0}),Q(()=>{document.querySelector("body").append(oe().ctx.$el)}),(b,a)=>(D("el-badge"),K("",!0))}},me=L(pe,[["__scopeId","data-v-043d2aea"]]);const _e=["onClick"],ye={__name:"filecontentmenu",emits:["putFileToRecycle","rename"],setup(E,{expose:o,emit:b}){let a=F([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),p=g(!0),c=F({});const l=F({x:0,y:0,display:"none"});let _=F({x:0,y:0,show:!1}),M=g(0);const V=async(r,f)=>{let{username:s,userid:y}=JSON.parse(sessionStorage.getItem("user"));switch(f){case"shear":let h=ce(s,c.fileid,c.filename+"."+c.filesuffix);return ue(h),B.success("分享链接已复制到粘贴板");case"delete":let{clientX:R,clientY:C}=r;_.x=R,_.y=C,_.show=!0;return;case"rename":return b("rename",M.value)}},$=r=>{p.value=!r.className.includes("icon-24gf-folderOpen");let{fileid:f,filename:s,filesuffix:y,folderid:h}=r.dataset;c.fileid=f,c.folderid=h,c.filename=s,c.filesuffix=y;let R={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},C=a.find(H=>H.icon==="icon-24gf-folderOpen");p.value?C&&a.shift():C||a.unshift(R)};return o({showContentMenu:(r,f)=>{M.value=f;let{target:s}=r;$(s),l.x=s.offsetLeft+r.offsetX,l.y=s.offsetTop+r.offsetY,l.display="block"},hiddenContentMenu:()=>(l.display="none",M.value=0)}),(r,f)=>(i(),u("div",null,[I("div",{onContextmenu:f[0]||(f[0]=N(()=>{},["stop"])),class:"contentmenu",style:j({left:l.x+"px",top:l.y+"px",display:l.display})},[(i(!0),u(q,null,J(d(a),(s,y)=>(i(),u("div",{key:y,onClick:h=>V(h,s.command)},[I("i",{class:Z(["iconfont",s.icon]),style:j({color:s.color})},null,6),I("span",null,A(s.name),1)],8,_e))),128))],36),O(me,{recyclePosition:d(_)},null,8,["recyclePosition"])]))}},ge=L(ye,[["__scopeId","data-v-b0bd5392"]]);const he=["onContextmenu"],xe={class:"pages-list"},ve={key:0,class:"pages-list-filesbread"},be={class:"pages-list-files"},Ce=["onDblclick","onContextmenu"],ke=["data-fileid","data-filename","data-filesuffix"],we=["onDblclick"],Fe=["onDblclick"],Ie={__name:"index",setup(E){var o=F([]);const b=g(null);let a=g(""),p=g(null),c=g(null),l=F([]),_=g("");P(()=>Y.state.searchKeyWord,e=>_.value=e,{immediate:!1,deep:!0}),P(()=>Y.state.topCreateData,e=>X(e),{immediate:!1,deep:!0});const M=(e,n)=>e==="word"?"#0f90e3":e==="xlsx"?"#01a408":e==="pdf"?"#ea5454":e==="txt"?"rgba(0, 0, 0, 0.6)":e==="md"?"#5A96DB":n==="folder"?"#ffd153":"",V=e=>{r(o[e])},$=(e,n)=>{if(n.type==="folder")return U(n),w.replace({query:{folderid:n.folderid,fromPath:w.currentRoute.value.query.folderid}});w.push({path:n.filesuffix==="xlsx"?`/excel/${n.fileid}`:`/edit/${n.fileid}`,query:n})},U=e=>{l.push({name:e.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(l))},W=()=>{l.pop(),w.replace({query:{folderid:w.currentRoute.value.query.fromPath}})},r=async e=>{o.forEach(n=>n.changeflag=!1),e.changeflag=!0,await G(),b.value[0].focus()},f=async()=>{let e="";if(o.forEach(n=>{n.changeflag&&(e=n.fileid,n.folderid,n.filename=a.value||n.filename,n.changeflag=!1)}),a.value){let n=e?await fe({fileid:e,newfilename:a.value}):{code:0,msg:"暂未实现文件夹更新"};n.code===200?B.success(n.msg):B.error(n.msg)}a.value=""},s=()=>b.value[0].blur();let y=g(!1);const h=async e=>{y.value=!0,await G(),p.value.showContentMenu(e),c.value.hiddenContentMenu()},R=()=>{y.value=!1},C=()=>{p.value&&p.value.hiddenContentMenu(),c.value.hiddenContentMenu()},H=(e,n)=>(c.value.showContentMenu(e,n),p.value&&p.value.hiddenContentMenu()),X=({name:e,id:n,type:x,suffix:m})=>{if(x==="folder")return o.push({type:"folder",foldername:e,folderid:n,icon:"icon-24gf-folderOpen"});let k={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel"};o.push({type:x,fileid:n,filename:e,suffix:m,icon:k[m]})},ee=e=>{o.splice(o.findIndex(n=>n.fileid===e),1)},ne=e=>{e.folderid&&(e.type="folder",e.icon="icon-24gf-folderOpen"),e.filesuffix==="md"&&(e.type="markdown",e.icon="icon-file-markdown1"),e.filesuffix==="txt"&&(e.type="txt",e.icon="icon-wenben1"),e.filesuffix==="xlsx"&&(e.type="excel",e.icon="icon-excel"),e.suffix=e.filesuffix};return P(w.currentRoute,async e=>{if(e.path!="/home/pages")return;o.length=0;let{userid:n}=JSON.parse(sessionStorage.getItem("user")),{folderid:x}=e.query;x||(l.length=0,sessionStorage.setItem("pagelistbread",[]));let m=await de({userid:n,folderid:x});if(m.code!==200)return B.error(m.msg);m.data.length&&m.data.forEach(k=>{ne(k),o.push(k)})},{immediate:!0,deep:!0}),Q(()=>{let e=sessionStorage.getItem("pagelistbread");e&&JSON.parse(e).forEach(n=>l.push(n))}),(e,n)=>{const x=D("el-icon"),m=D("el-breadcrumb-item"),k=D("el-breadcrumb"),te=D("el-input");return i(),u("div",{class:"pages",onClick:C,onContextmenu:N(h,["prevent","stop"])},[d(y)?(i(),T(re,{key:0,ref_key:"contentmenuRef",ref:p,onCreate:X,onClose:R},null,512)):K("",!0),O(ge,{ref_key:"filecontentmenuRef",ref:c,onPutFileToRecycle:ee,onRename:V},null,512),I("div",xe,[d(l).length?(i(),u("div",ve,[O(x,{onClick:W},{default:z(()=>[O(d(le))]),_:1}),O(k,{separator:"/"},{default:z(()=>[(i(!0),u(q,null,J(d(l),(t,S)=>(i(),T(m,{key:S},{default:z(()=>[ae(A(t.name),1)]),_:2},1024))),128))]),_:1})])):K("",!0),I("div",be,[(i(!0),u(q,null,J(d(o).filter(t=>!d(_)||(t.filename||t.foldername).includes(d(_))),(t,S)=>(i(),u("div",{onDblclick:v=>$(S,t),onContextmenu:N(v=>H(v,S),["prevent","stop"]),class:"pages-list-files-item",key:S},[I("i",{"data-fileid":t.fileid,"data-filename":t.filename,"data-filesuffix":t.suffix||t.filesuffix,class:Z(["iconfont",t.icon]),style:j({color:M(t.suffix,t.type)})},null,14,ke),t.changeflag?(i(),T(te,{key:1,ref_for:!0,ref_key:"inputRef",ref:b,onBlur:f,onKeydown:se(s,["enter"]),modelValue:d(a),"onUpdate:modelValue":n[0]||(n[0]=v=>ie(a)?a.value=v:a=v)},null,8,["onKeydown","modelValue"])):(i(),u(q,{key:0},[t.type==="folder"?(i(),u("span",{key:0,onDblclick:N(v=>r(t),["stop"])},A(t.foldername),41,we)):(i(),u("span",{key:1,onDblclick:N(v=>r(t),["stop"])},A(t.filename+"."+t.suffix),41,Fe))],64))],40,Ce))),128))])])],40,he)}}},Pe=L(Ie,[["__scopeId","data-v-2044bbea"]]);export{Pe as default};
