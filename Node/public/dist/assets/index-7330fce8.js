import{_ as L,w as P,m as Z,B as Y,a as D,v as K,l as F,r as h,o as i,c as f,b as I,F as $,j as J,n as ee,C as j,t as q,u as p,q as N,d as O,y as A,f as w,i as H,e as z,D as le,z as ae,G as se,H as ie,g as G,x as Q}from"./index-32a3f408.js";import{C as re}from"./index-aacee316.js";import{c as ce}from"./shear-451f6afe.js";import{e as fe}from"./execcontent-0635da60.js";import"./index-28c78071.js";import{u as de,g as ue}from"./index-4b20d44a.js";const pe={__name:"recycleAnimation",props:{recyclePosition:{type:Object,default:()=>{}}},setup(B){const{recyclePosition:o}=B;return P(o,()=>{console.log(o)},{immediate:!1,deep:!0}),Z(()=>{nextTick(()=>{const d=document.querySelector("body");d.append?d.append(Y().ctx.$el):d.appendChild(Y().ctx.$el)})}),(d,a)=>(D("el-badge"),K("",!0))}},me=L(pe,[["__scopeId","data-v-d3da74f6"]]);const _e=["onClick"],ye={__name:"filecontentmenu",emits:["putFileToRecycle","rename"],setup(B,{expose:o,emit:d}){let a=F([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),m=h(!0),c=F({});const l=F({x:0,y:0,display:"none"});let y=F({x:0,y:0,show:!1}),M=h(0);const E=async(r,u)=>{let{username:s,userid:g}=JSON.parse(sessionStorage.getItem("user"));switch(u){case"shear":let x=ce(s,c.fileid,c.filename+"."+c.filesuffix);return fe(x),A.success("分享链接已复制到粘贴板");case"delete":let{clientX:R,clientY:C}=r;y.x=R,y.y=C,y.show=!0;return;case"rename":return d("rename",M.value)}},T=r=>{m.value=!r.className.includes("icon-24gf-folderOpen");let{fileid:u,filename:s,filesuffix:g,folderid:x}=r.dataset;c.fileid=u,c.folderid=x,c.filename=s,c.filesuffix=g;let R={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},C=a.find(V=>V.icon==="icon-24gf-folderOpen");m.value?C&&a.shift():C||a.unshift(R)};return o({showContentMenu:(r,u)=>{M.value=u;let{target:s}=r;T(s),l.x=s.offsetLeft+r.offsetX,l.y=s.offsetTop+r.offsetY,l.display="block"},hiddenContentMenu:()=>(l.display="none",M.value=0)}),(r,u)=>(i(),f("div",null,[I("div",{onContextmenu:u[0]||(u[0]=N(()=>{},["stop"])),class:"contentmenu",style:j({left:l.x+"px",top:l.y+"px",display:l.display})},[(i(!0),f($,null,J(p(a),(s,g)=>(i(),f("div",{key:g,onClick:x=>E(x,s.command)},[I("i",{class:ee(["iconfont",s.icon]),style:j({color:s.color})},null,6),I("span",null,q(s.name),1)],8,_e))),128))],36),O(me,{recyclePosition:p(y)},null,8,["recyclePosition"])]))}},ge=L(ye,[["__scopeId","data-v-b0bd5392"]]);const he=["onContextmenu"],xe={class:"pages-list"},ve={key:0,class:"pages-list-filesbread"},be={class:"pages-list-files"},Ce=["onDblclick","onContextmenu"],ke=["data-fileid","data-filename","data-filesuffix"],we=["onDblclick"],Fe=["onDblclick"],Ie={__name:"index",setup(B){var o=F([]);const d=h(null);let a=h(""),m=h(null),c=h(null),l=F([]),y=h("");P(()=>G.state.searchKeyWord,e=>y.value=e,{immediate:!1,deep:!0}),P(()=>G.state.topCreateData,e=>X(e),{immediate:!1,deep:!0});const M=(e,n)=>e==="word"?"#0f90e3":e==="xlsx"?"#01a408":e==="pdf"?"#ea5454":e==="txt"?"rgba(0, 0, 0, 0.6)":e==="md"?"#5A96DB":n==="folder"?"#ffd153":"",E=e=>{r(o[e])},T=(e,n)=>{if(n.type==="folder")return U(n),w.replace({query:{folderid:n.folderid,fromPath:w.currentRoute.value.query.folderid}});w.push({path:n.filesuffix==="xlsx"?`/excel/${n.fileid}`:`/edit/${n.fileid}`,query:n})},U=e=>{l.push({name:e.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(l))},W=()=>{l.pop(),w.replace({query:{folderid:w.currentRoute.value.query.fromPath}})},r=async e=>{o.forEach(n=>n.changeflag=!1),e.changeflag=!0,await Q(),d.value[0].focus()},u=async()=>{let e="";if(o.forEach(n=>{n.changeflag&&(e=n.fileid,n.folderid,n.filename=a.value||n.filename,n.changeflag=!1)}),a.value){let n=e?await de({fileid:e,newfilename:a.value}):{code:0,msg:"暂未实现文件夹更新"};n.code===200?A.success(n.msg):A.error(n.msg)}a.value=""},s=()=>d.value[0].blur();let g=h(!1);const x=async e=>{g.value=!0,await Q(),m.value.showContentMenu(e),c.value.hiddenContentMenu()},R=()=>{g.value=!1},C=()=>{m.value&&m.value.hiddenContentMenu(),c.value.hiddenContentMenu()},V=(e,n)=>(c.value.showContentMenu(e,n),m.value&&m.value.hiddenContentMenu()),X=({name:e,id:n,type:v,suffix:_})=>{if(v==="folder")return o.push({type:"folder",foldername:e,folderid:n,icon:"icon-24gf-folderOpen"});let k={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel"};o.push({type:v,fileid:n,filename:e,suffix:_,icon:k[_]})},ne=e=>{o.splice(o.findIndex(n=>n.fileid===e),1)},te=e=>{e.folderid&&(e.type="folder",e.icon="icon-24gf-folderOpen"),e.filesuffix==="md"&&(e.type="markdown",e.icon="icon-file-markdown1"),e.filesuffix==="txt"&&(e.type="txt",e.icon="icon-wenben1"),e.filesuffix==="xlsx"&&(e.type="excel",e.icon="icon-excel"),e.suffix=e.filesuffix};return P(w.currentRoute,async e=>{if(e.path!="/home/pages")return;o.length=0;let{userid:n}=JSON.parse(sessionStorage.getItem("user")),{folderid:v}=e.query;v||(l.length=0,sessionStorage.setItem("pagelistbread",[]));let _=await ue({userid:n,folderid:v});if(_.code!==200)return A.error(_.msg);_.data.length&&_.data.forEach(k=>{te(k),o.push(k)})},{immediate:!0,deep:!0}),Z(()=>{let e=sessionStorage.getItem("pagelistbread");e&&JSON.parse(e).forEach(n=>l.push(n))}),(e,n)=>{const v=D("el-icon"),_=D("el-breadcrumb-item"),k=D("el-breadcrumb"),oe=D("el-input");return i(),f("div",{class:"pages",onClick:C,onContextmenu:N(x,["prevent","stop"])},[p(g)?(i(),H(re,{key:0,ref_key:"contentmenuRef",ref:m,onCreate:X,onClose:R},null,512)):K("",!0),O(ge,{ref_key:"filecontentmenuRef",ref:c,onPutFileToRecycle:ne,onRename:E},null,512),I("div",xe,[p(l).length?(i(),f("div",ve,[O(v,{onClick:W},{default:z(()=>[O(p(le))]),_:1}),O(k,{separator:"/"},{default:z(()=>[(i(!0),f($,null,J(p(l),(t,S)=>(i(),H(_,{key:S},{default:z(()=>[ae(q(t.name),1)]),_:2},1024))),128))]),_:1})])):K("",!0),I("div",be,[(i(!0),f($,null,J(p(o).filter(t=>!p(y)||(t.filename||t.foldername).includes(p(y))),(t,S)=>(i(),f("div",{onDblclick:b=>T(S,t),onContextmenu:N(b=>V(b,S),["prevent","stop"]),class:"pages-list-files-item",key:S},[I("i",{"data-fileid":t.fileid,"data-filename":t.filename,"data-filesuffix":t.suffix||t.filesuffix,class:ee(["iconfont",t.icon]),style:j({color:M(t.suffix,t.type)})},null,14,ke),t.changeflag?(i(),H(oe,{key:1,ref_for:!0,ref_key:"inputRef",ref:d,onBlur:u,onKeydown:se(s,["enter"]),modelValue:p(a),"onUpdate:modelValue":n[0]||(n[0]=b=>ie(a)?a.value=b:a=b)},null,8,["onKeydown","modelValue"])):(i(),f($,{key:0},[t.type==="folder"?(i(),f("span",{key:0,onDblclick:N(b=>r(t),["stop"])},q(t.foldername),41,we)):(i(),f("span",{key:1,onDblclick:N(b=>r(t),["stop"])},q(t.filename+"."+t.suffix),41,Fe))],64))],40,Ce))),128))])])],40,he)}}},Pe=L(Ie,[["__scopeId","data-v-2044bbea"]]);export{Pe as default};
