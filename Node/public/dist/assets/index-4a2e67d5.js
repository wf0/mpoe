import{_ as W,l as I,r as y,o as s,c as f,b,F as T,j as P,n as G,B as z,t as E,u as g,q as M,y as x,E as ne,w as q,f as C,m as te,a as S,i as V,v as L,d as B,e as A,C as oe,z as le,D as se,G as ae,g as j,x as U}from"./index-0b5efba7.js";import{C as ie}from"./index-07637bb4.js";import{c as re}from"./shear-fd4281e8.js";import{e as ce}from"./execcontent-0635da60.js";import{p as fe,u as de,g as ue}from"./index-7dcefcd1.js";import"./index-355d01f8.js";const pe=["onClick"],me={__name:"filecontentmenu",emits:["putFileToRecycle"],setup(X,{expose:c,emit:k}){let a=I([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),p=y(!0),o=I({});const l=I({x:0,y:0,display:"none"}),w=async r=>{let{username:i,userid:d}=JSON.parse(sessionStorage.getItem("user"));if(r==="shear"){let u=re(i,o.fileid,o.filename+"."+o.filesuffix);ce(u),x.success("分享链接已复制到粘贴板")}if(r==="delete"){if(!o.fileid)return;try{await ne.confirm(`确认删除 ${o.filename+"."+o.filesuffix} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let{code:u,msg:m}=await fe({fileid:o.fileid,userid:d});if(u!==200)return x.error(m);x.success(m),k("putFileToRecycle",o.fileid)}catch{x.info("已取消")}}},N=r=>{p.value=!r.className.includes("icon-24gf-folderOpen");let{fileid:i,filename:d,filesuffix:u,folderid:m}=r.dataset;o.fileid=i,o.folderid=m,o.filename=d,o.filesuffix=u;let O={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},R=a.find($=>$.icon==="icon-24gf-folderOpen");p.value?R&&a.shift():R||a.unshift(O)};return c({showContentMenu:r=>{let{target:i}=r;N(i),l.x=i.offsetLeft+r.offsetX,l.y=i.offsetTop+r.offsetY,l.display="block"},hiddenContentMenu:()=>l.display="none"}),(r,i)=>(s(),f("div",null,[b("div",{onContextmenu:i[0]||(i[0]=M(()=>{},["stop"])),class:"contentmenu",style:z({left:l.x+"px",top:l.y+"px",display:l.display})},[(s(!0),f(T,null,P(g(a),(d,u)=>(s(),f("div",{key:u,onClick:m=>w(d.command)},[b("i",{class:G(["iconfont",d.icon]),style:z({color:d.color})},null,6),b("span",null,E(d.name),1)],8,pe))),128))],36)]))}},_e=W(me,[["__scopeId","data-v-49d36f22"]]);const ge=["onContextmenu"],he={class:"pages-list"},ye={key:0,class:"pages-list-filesbread"},xe={class:"pages-list-files"},ve=["onDblclick","onContextmenu"],Ce=["data-fileid","data-filename","data-filesuffix"],be=["onDblclick"],ke=["onDblclick"],we={__name:"index",setup(X){var c=I([]);const k=y(null);let a=y(""),p=y(null),o=y(null),l=I([]),w=y("");q(()=>j.state.searchKeyWord,e=>w.value=e,{immediate:!1,deep:!0}),q(()=>j.state.topCreateData,e=>J(e),{immediate:!1,deep:!0});const N=(e,n)=>e==="word"?"#0f90e3":e==="xlsx"?"#01a408":e==="pdf"?"#ea5454":e==="txt"?"rgba(0, 0, 0, 0.6)":e==="md"?"#5A96DB":n==="folder"?"#ffd153":"",H=(e,n)=>{if(n.type==="folder")return K(n),C.replace({query:{folderid:n.folderid,fromPath:C.currentRoute.value.query.folderid}});C.push({path:n.filesuffix==="xlsx"?`/excel/${n.fileid}`:`/edit/${n.fileid}`,query:n})},K=e=>{l.push({name:e.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(l))},r=()=>{l.pop(),C.replace({query:{folderid:C.currentRoute.value.query.fromPath}})},i=async e=>{c.forEach(n=>n.changeflag=!1),e.changeflag=!0,await U(),k.value[0].focus()},d=async()=>{let e="";if(c.forEach(n=>{n.changeflag&&(e=n.fileid,n.folderid,n.filename=a.value||n.filename,n.changeflag=!1)}),a.value){let n=e?await de({fileid:e,newfilename:a.value}):{code:0,msg:"暂未实现文件夹更新"};n.code===200?x.success(n.msg):x.error(n.msg)}a.value=""},u=()=>k.value[0].blur();let m=y(!1);const O=async e=>{m.value=!0,await U(),p.value.showContentMenu(e),o.value.hiddenContentMenu()},R=()=>{m.value=!1},$=()=>{p.value&&p.value.hiddenContentMenu(),o.value.hiddenContentMenu()},Y=e=>(o.value.showContentMenu(e),p.value&&p.value.hiddenContentMenu()),J=({name:e,id:n,type:h,suffix:_})=>{if(h==="folder")return c.push({type:"folder",foldername:e,folderid:n,icon:"icon-24gf-folderOpen"});let v={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel"};c.push({type:h,fileid:n,filename:e,suffix:_,icon:v[_]})},Q=e=>{c.splice(c.findIndex(n=>n.fileid===e),1)},Z=e=>{e.folderid&&(e.type="folder",e.icon="icon-24gf-folderOpen"),e.filesuffix==="md"&&(e.type="markdown",e.icon="icon-file-markdown1"),e.filesuffix==="txt"&&(e.type="txt",e.icon="icon-wenben1"),e.filesuffix==="xlsx"&&(e.type="excel",e.icon="icon-excel"),e.suffix=e.filesuffix};return q(C.currentRoute,async e=>{if(e.path!="/home/pages")return;c.length=0;let{userid:n}=JSON.parse(sessionStorage.getItem("user")),{folderid:h}=e.query;h||(l.length=0,sessionStorage.setItem("pagelistbread",[]));let _=await ue({userid:n,folderid:h});if(_.code!==200)return x.error(_.msg);_.data.length&&_.data.forEach(v=>{Z(v),c.push(v)})},{immediate:!0,deep:!0}),te(()=>{let e=sessionStorage.getItem("pagelistbread");e&&JSON.parse(e).forEach(n=>l.push(n))}),(e,n)=>{const h=S("el-icon"),_=S("el-breadcrumb-item"),v=S("el-breadcrumb"),ee=S("el-input");return s(),f("div",{class:"pages",onClick:$,onContextmenu:M(O,["prevent","stop"])},[g(m)?(s(),V(ie,{key:0,ref_key:"contentmenuRef",ref:p,onCreate:J,onClose:R},null,512)):L("",!0),B(_e,{ref_key:"filecontentmenuRef",ref:o,onPutFileToRecycle:Q},null,512),b("div",he,[g(l).length?(s(),f("div",ye,[B(h,{onClick:r},{default:A(()=>[B(g(oe))]),_:1}),B(v,{separator:"/"},{default:A(()=>[(s(!0),f(T,null,P(g(l),(t,D)=>(s(),V(_,{key:D},{default:A(()=>[le(E(t.name),1)]),_:2},1024))),128))]),_:1})])):L("",!0),b("div",xe,[(s(!0),f(T,null,P(g(c).filter(t=>!g(w)||(t.filename||t.foldername).includes(g(w))),(t,D)=>(s(),f("div",{onDblclick:F=>H(D,t),onContextmenu:M(Y,["prevent","stop"]),class:"pages-list-files-item",key:D},[b("i",{"data-fileid":t.fileid,"data-filename":t.filename,"data-filesuffix":t.suffix||t.filesuffix,class:G(["iconfont",t.icon]),style:z({color:N(t.suffix,t.type)})},null,14,Ce),t.changeflag?(s(),V(ee,{key:1,ref_for:!0,ref_key:"inputRef",ref:k,onBlur:d,onKeydown:se(u,["enter"]),modelValue:g(a),"onUpdate:modelValue":n[0]||(n[0]=F=>ae(a)?a.value=F:a=F)},null,8,["onKeydown","modelValue"])):(s(),f(T,{key:0},[t.type==="folder"?(s(),f("span",{key:0,onDblclick:M(F=>i(t),["stop"])},E(t.foldername),41,be)):(s(),f("span",{key:1,onDblclick:M(F=>i(t),["stop"])},E(t.filename+"."+t.suffix),41,ke))],64))],40,ve))),128))])])],40,ge)}}},Be=W(we,[["__scopeId","data-v-638d80bd"]]);export{Be as default};
