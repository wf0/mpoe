import{_ as G,l as S,r as g,o as s,c as f,b as I,F as E,j as P,n as X,B as z,t as N,u as _,q as D,E as te,y as k,w as $,f as M,m as oe,a as B,i as A,v as j,d as T,e as H,C as le,z as ae,D as se,G as ie,g as U,x as W}from"./index-aca15ea0.js";import{C as re}from"./index-ed4c835f.js";import{c as ce}from"./shear-2d039c0e.js";import{e as fe}from"./execcontent-0635da60.js";import{p as ue,u as de,g as pe}from"./index-215fae79.js";import"./index-d9bb7fc4.js";const me=["onClick"],_e={__name:"filecontentmenu",emits:["putFileToRecycle","rename"],setup(Y,{expose:r,emit:b}){let i=S([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),p=g(!0),o=S({});const l=S({x:0,y:0,display:"none"});let h=g(0);const O=async(u,c)=>{let{username:a,userid:y}=JSON.parse(sessionStorage.getItem("user"));switch(c){case"shear":let m=ce(a,o.fileid,o.filename+"."+o.filesuffix);return fe(m),k.success("分享链接已复制到粘贴板");case"delete":if(!o.fileid)return;try{await te.confirm(`确认删除 ${o.filename+"."+o.filesuffix} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let{code:w,msg:x}=await ue({fileid:o.fileid,userid:y});if(w!==200)return k.error(x);k.success(x),b("putFileToRecycle",o.fileid)}catch{k.info("已取消")}return;case"rename":return b("rename",h.value)}},q=u=>{p.value=!u.className.includes("icon-24gf-folderOpen");let{fileid:c,filename:a,filesuffix:y,folderid:m}=u.dataset;o.fileid=c,o.folderid=m,o.filename=a,o.filesuffix=y;let w={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},x=i.find(V=>V.icon==="icon-24gf-folderOpen");p.value?x&&i.shift():x||i.unshift(w)};return r({showContentMenu:(u,c)=>{h.value=c;let{target:a}=u;q(a),l.x=a.offsetLeft+u.offsetX,l.y=a.offsetTop+u.offsetY,l.display="block"},hiddenContentMenu:()=>(l.display="none",h.value=0)}),(u,c)=>(s(),f("div",null,[I("div",{onContextmenu:c[0]||(c[0]=D(()=>{},["stop"])),class:"contentmenu",style:z({left:l.x+"px",top:l.y+"px",display:l.display})},[(s(!0),f(E,null,P(_(i),(a,y)=>(s(),f("div",{key:y,onClick:m=>O(m,a.command)},[I("i",{class:X(["iconfont",a.icon]),style:z({color:a.color})},null,6),I("span",null,N(a.name),1)],8,me))),128))],36)]))}},ge=G(_e,[["__scopeId","data-v-e8799813"]]);const he=["onContextmenu"],ye={class:"pages-list"},xe={key:0,class:"pages-list-filesbread"},ve={class:"pages-list-files"},Ce=["onDblclick","onContextmenu"],ke=["data-fileid","data-filename","data-filesuffix"],be=["onDblclick"],we=["onDblclick"],Fe={__name:"index",setup(Y){var r=S([]);const b=g(null);let i=g(""),p=g(null),o=g(null),l=S([]),h=g("");$(()=>U.state.searchKeyWord,e=>h.value=e,{immediate:!1,deep:!0}),$(()=>U.state.topCreateData,e=>L(e),{immediate:!1,deep:!0});const O=(e,n)=>e==="word"?"#0f90e3":e==="xlsx"?"#01a408":e==="pdf"?"#ea5454":e==="txt"?"rgba(0, 0, 0, 0.6)":e==="md"?"#5A96DB":n==="folder"?"#ffd153":"",q=e=>{c(r[e])},K=(e,n)=>{if(n.type==="folder")return J(n),M.replace({query:{folderid:n.folderid,fromPath:M.currentRoute.value.query.folderid}});M.push({path:n.filesuffix==="xlsx"?`/excel/${n.fileid}`:`/edit/${n.fileid}`,query:n})},J=e=>{l.push({name:e.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(l))},u=()=>{l.pop(),M.replace({query:{folderid:M.currentRoute.value.query.fromPath}})},c=async e=>{r.forEach(n=>n.changeflag=!1),e.changeflag=!0,await W(),b.value[0].focus()},a=async()=>{let e="";if(r.forEach(n=>{n.changeflag&&(e=n.fileid,n.folderid,n.filename=i.value||n.filename,n.changeflag=!1)}),i.value){let n=e?await de({fileid:e,newfilename:i.value}):{code:0,msg:"暂未实现文件夹更新"};n.code===200?k.success(n.msg):k.error(n.msg)}i.value=""},y=()=>b.value[0].blur();let m=g(!1);const w=async e=>{m.value=!0,await W(),p.value.showContentMenu(e),o.value.hiddenContentMenu()},x=()=>{m.value=!1},V=()=>{p.value&&p.value.hiddenContentMenu(),o.value.hiddenContentMenu()},Q=(e,n)=>(o.value.showContentMenu(e,n),p.value&&p.value.hiddenContentMenu()),L=({name:e,id:n,type:v,suffix:d})=>{if(v==="folder")return r.push({type:"folder",foldername:e,folderid:n,icon:"icon-24gf-folderOpen"});let F={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel"};r.push({type:v,fileid:n,filename:e,filesuffix:d,suffix:d,icon:F[d]})},Z=e=>{r.splice(r.findIndex(n=>n.fileid===e),1)},ee=e=>{e.folderid&&(e.type="folder",e.icon="icon-24gf-folderOpen"),e.filesuffix==="md"&&(e.type="markdown",e.icon="icon-file-markdown1"),e.filesuffix==="txt"&&(e.type="txt",e.icon="icon-wenben1"),e.filesuffix==="xlsx"&&(e.type="excel",e.icon="icon-excel"),e.suffix=e.filesuffix};return $(M.currentRoute,async e=>{if(e.path!="/home/pages")return;r.length=0;let{userid:n}=JSON.parse(sessionStorage.getItem("user")),{folderid:v}=e.query;v||(l.length=0,sessionStorage.setItem("pagelistbread",[]));let d=await pe({userid:n,folderid:v});if(d.code!==200)return k.error(d.msg);d.data.length&&d.data.forEach(F=>{ee(F),r.push(F)})},{immediate:!0,deep:!0}),oe(()=>{let e=sessionStorage.getItem("pagelistbread");e&&JSON.parse(e).forEach(n=>l.push(n))}),(e,n)=>{const v=B("el-icon"),d=B("el-breadcrumb-item"),F=B("el-breadcrumb"),ne=B("el-input");return s(),f("div",{class:"pages",onClick:V,onContextmenu:D(w,["prevent","stop"])},[_(m)?(s(),A(re,{key:0,ref_key:"contentmenuRef",ref:p,onCreate:L,onClose:x},null,512)):j("",!0),T(ge,{ref_key:"filecontentmenuRef",ref:o,onPutFileToRecycle:Z,onRename:q},null,512),I("div",ye,[_(l).length?(s(),f("div",xe,[T(v,{onClick:u},{default:H(()=>[T(_(le))]),_:1}),T(F,{separator:"/"},{default:H(()=>[(s(!0),f(E,null,P(_(l),(t,R)=>(s(),A(d,{key:R},{default:H(()=>[ae(N(t.name),1)]),_:2},1024))),128))]),_:1})])):j("",!0),I("div",ve,[(s(!0),f(E,null,P(_(r).filter(t=>!_(h)||(t.filename||t.foldername).includes(_(h))),(t,R)=>(s(),f("div",{onDblclick:C=>K(R,t),onContextmenu:D(C=>Q(C,R),["prevent","stop"]),class:"pages-list-files-item",key:R},[I("i",{"data-fileid":t.fileid,"data-filename":t.filename,"data-filesuffix":t.suffix||t.filesuffix,class:X(["iconfont",t.icon]),style:z({color:O(t.suffix,t.type)})},null,14,ke),t.changeflag?(s(),A(ne,{key:1,ref_for:!0,ref_key:"inputRef",ref:b,onBlur:a,onKeydown:se(y,["enter"]),modelValue:_(i),"onUpdate:modelValue":n[0]||(n[0]=C=>ie(i)?i.value=C:i=C)},null,8,["onKeydown","modelValue"])):(s(),f(E,{key:0},[t.type==="folder"?(s(),f("span",{key:0,onDblclick:D(C=>c(t),["stop"])},N(t.foldername),41,be)):(s(),f("span",{key:1,onDblclick:D(C=>c(t),["stop"])},N(t.filename+"."+t.suffix),41,we))],64))],40,Ce))),128))])])],40,he)}}},Te=G(Fe,[["__scopeId","data-v-16dd3e79"]]);export{Te as default};
