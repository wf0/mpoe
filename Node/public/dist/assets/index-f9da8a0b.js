import{_ as L,j as v,a as I,o as u,c as p,b as x,F as q,h as P,n as T,y as B,t as A,u as f,l as V,d as k,w as S,v as W,E as M,e as F,r as E,q as j,k as X,m as Y,z as G,g as U,A as Q,B as Z,C as ee}from"./index-264bb53a.js";import{f as ne}from"./index-a16080e8.js";import{c as te,g as oe}from"./index-056c5fe3.js";import{c as le}from"./shear-fd4281e8.js";import{e as ae}from"./execcontent-0635da60.js";const se=H=>ne({url:"/folder/createFolder",method:"post",data:H}),ie=[{icon:"icon-24gf-folderOpen",name:"新建文件夹",color:"#FFD153",command:"folder"},{icon:"icon-Word",name:"新建在线文档",color:"#2A8CFF",command:"word"},{icon:"icon-excel",name:"新建在线表格",color:"#00C476",command:"excel"},{icon:"icon-wenben1",name:"新建在线文本",color:"",command:"txt"},{icon:"icon-file-markdown1",name:"新建markdown",color:"#1296db",command:"markdown"},{name:"导入本地文件",command:"inputfile"},{name:"更多类型",command:"more"},{name:"批量管理",command:"manage"}];const re=["onClick"],ce={class:"dialog-footer"},de={__name:"index",emits:["create"],setup(H,{expose:h,emit:N}){let e=v({show:!1,title:"",input:"",warning:"",placeholder:""});const i=v({x:0,y:0,display:"none"}),m=l=>{switch(l){case"folder":e.type=l,e.show=!0,e.title="创建文件夹",e.warning="请输入文件夹名称",e.placeholder="请输入文件夹名称";break;case"word":break;case"excel":break;case"txt":e.type=l,e.show=!0,e.title="新建文本文档",e.warning="文件名称不能为空",e.placeholder="请输入文件名称";break;case"markdown":e.type=l,e.show=!0,e.title="新建markdown文档",e.warning="文件名称不能为空",e.placeholder="请输入文件名称";break}},c=(l,t)=>{if(t){i.x=l.x,i.y=l.y,i.display="block";return}const o=l.target.clientWidth,a=l.target.clientHeight,g=l.target.childNodes[0].clientWidth||150,r=l.target.childNodes[0].clientHeight||200,{offsetX:_,offsetY:y}=l,C=_+g>=o?_-g:_,n=y+r>=a?y-r:y;i.x=C,i.y=n,i.display="block"},O=()=>i.display="none",R=async(l,t)=>{let o=await se({userid:l,foldername:t});return o.code!==200?M.error(o.msg):(M.success(o.msg),o.data)},J=async()=>{if(!e.input)return M.warning(e.warning);let{userid:l}=JSON.parse(sessionStorage.getItem("user")),t={type:e.type};if(e.type==="folder"){let o=e.input,a=await R(l,o);t.id=a,t.name=o}else{let{userid:o}=JSON.parse(sessionStorage.getItem("user")),a=e.input,g=e.type,_={txt:"txt",markdown:"md",word:"dox"}[e.type],y=F.currentRoute.value.query.folderid,C=await te({userid:o,filename:a,filetype:g,filesuffix:_,fileownerfolderid:y});if(C.code!==200)return M.error(C.msg);M.success(C.msg),t.id=C.data,t.name=a,t.suffix=_}e.show=!1,e.input="",N("create",t)};return h({showContentMenu:c,hiddenContentMenu:O}),(l,t)=>{const o=I("el-input"),a=I("el-button"),g=I("el-dialog");return u(),p("div",null,[x("div",{onContextmenu:t[0]||(t[0]=V(()=>{},["stop"])),class:"contentmenu",style:B({left:i.x+"px",top:i.y+"px",display:i.display})},[(u(!0),p(q,null,P(f(ie),(r,_)=>(u(),p("div",{key:_,onClick:y=>m(r.command)},[x("i",{class:T(["iconfont",r.icon]),style:B({color:r.color})},null,6),x("span",null,A(r.name),1)],8,re))),128))],36),k(g,{modelValue:f(e).show,"onUpdate:modelValue":t[3]||(t[3]=r=>f(e).show=r),title:f(e).title,width:"30%"},{footer:S(()=>[x("span",ce,[k(a,{onClick:t[2]||(t[2]=r=>(f(e).show=!1,f(e).input=""))},{default:S(()=>[W(" 取消 ")]),_:1}),k(a,{type:"primary",onClick:J},{default:S(()=>[W(" 确定 ")]),_:1})])]),default:S(()=>[k(o,{modelValue:f(e).input,"onUpdate:modelValue":t[1]||(t[1]=r=>f(e).input=r),placeholder:f(e).placeholder},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue","title"])])}}},ue=L(de,[["__scopeId","data-v-edaa1e34"]]);const fe=["onClick"],pe={__name:"filecontentmenu",emits:["createFolder"],setup(H,{expose:h,emit:N}){let e=v([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan"},{name:"重命名",icon:"icon-zhongmingming"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),i=E(!0),m=v({});const c=v({x:0,y:0,display:"none"}),O=t=>{let{username:o}=JSON.parse(sessionStorage.getItem("user"));if(t==="shear"){let a=le(o,m.fileid,m.filename+"."+m.filesuffix);ae(a),M.success("分享链接已复制到粘贴板")}},R=t=>{i.value=!t.className.includes("icon-24gf-folderOpen");let{fileid:o,filename:a,filesuffix:g}=t.dataset;m.fileid=o,m.filename=a,m.filesuffix=g;let r={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},_=e.find(y=>y.icon==="icon-24gf-folderOpen");i.value?_&&e.shift():_||e.unshift(r)};return h({showContentMenu:t=>{let{target:o}=t;R(o),c.x=o.offsetLeft+t.offsetX,c.y=o.offsetTop+t.offsetY,c.display="block"},hiddenContentMenu:()=>c.display="none"}),(t,o)=>(u(),p("div",null,[x("div",{onContextmenu:o[0]||(o[0]=V(()=>{},["stop"])),class:"contentmenu",style:B({left:c.x+"px",top:c.y+"px",display:c.display})},[(u(!0),p(q,null,P(f(e),(a,g)=>(u(),p("div",{key:g,onClick:r=>O(a.command)},[x("i",{class:T(["iconfont",a.icon]),style:B({color:a.color})},null,6),x("span",null,A(a.name),1)],8,fe))),128))],36)]))}},me=L(pe,[["__scopeId","data-v-6293ed95"]]);const _e=["onContextmenu"],ge={class:"pages-list"},he={key:0,class:"pages-list-filesbread"},ye={class:"pages-list-files"},xe=["onDblclick","onContextmenu"],we=["data-fileid","data-filename","data-filesuffix"],ke=["onDblclick"],ve=["onDblclick"],Ce={__name:"index",setup(H){var h=v([]);const N=E(null);let e=E(""),i=E(null),m=E(null),c=v([]);const O=(n,s)=>n==="word"?"#0f90e3":n==="excel"?"#01a408":n==="pdf"?"#ea5454":n==="txt"?"rgba(0, 0, 0, 0.6)":n==="md"?"#5A96DB":s==="folder"?"#ffd153":"",R=(n,s)=>{if(s.type==="folder")return J(s),F.replace({query:{folderid:s.folderid,fromPath:F.currentRoute.value.query.folderid}});F.push({path:`/edit/${s.fileid}`,query:s})},J=n=>{c.push({name:n.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(c))},l=()=>{c.pop(),F.replace({query:{folderid:F.currentRoute.value.query.fromPath}})},t=async n=>{h.forEach(s=>s.changeflag=!1),n.changeflag=!0,await ee(),N.value[0].focus()},o=()=>{h.forEach(n=>{n.changeflag&&(n.filename=e.value,n.changeflag=!1)}),e.value=""},a=()=>N.value[0].blur(),g=n=>{i.value.showContentMenu(n),m.value.hiddenContentMenu()},r=()=>{i.value.hiddenContentMenu(),m.value.hiddenContentMenu()},_=n=>(m.value.showContentMenu(n),i.value.hiddenContentMenu()),y=({name:n,id:s,type:b,suffix:w})=>{if(b==="folder")return h.push({type:"folder",foldername:n,folderid:s,icon:"icon-24gf-folderOpen"});let D={md:"icon-file-markdown1",txt:"icon-wenben1"};h.push({type:b,fileid:s,filename:n,suffix:w,icon:D[w]})},C=n=>{n.folderid&&(n.type="folder",n.icon="icon-24gf-folderOpen"),n.filesuffix==="md"&&(n.type="markdown",n.icon="icon-file-markdown1"),n.filesuffix==="txt"&&(n.type="txt",n.icon="icon-wenben1"),n.suffix=n.filesuffix};return j(F.currentRoute,async n=>{if(n.path!="/home/pages")return;h=v([]);let{userid:s}=JSON.parse(sessionStorage.getItem("user")),{folderid:b}=n.query;b||(c=v([]),sessionStorage.setItem("pagelistbread",[]));let w=await oe({userid:s,folderid:b});if(w.code!==200)return M.error(w.msg);w.data.length&&w.data.forEach(D=>{C(D),h.push(D)})},{immediate:!0,deep:!0}),X(()=>{let n=sessionStorage.getItem("pagelistbread");n&&JSON.parse(n).forEach(s=>c.push(s))}),(n,s)=>{const b=I("el-icon"),w=I("el-breadcrumb-item"),D=I("el-breadcrumb"),K=I("el-input");return u(),p("div",{class:"pages",onClick:r,onContextmenu:V(g,["prevent","stop"])},[k(ue,{ref_key:"contentmenuRef",ref:i,onCreate:y},null,512),k(me,{ref_key:"filecontentmenuRef",ref:m},null,512),x("div",ge,[f(c).length?(u(),p("div",he,[k(b,{onClick:l},{default:S(()=>[k(f(G))]),_:1}),k(D,{separator:"/"},{default:S(()=>[(u(!0),p(q,null,P(f(c),(d,z)=>(u(),U(w,{key:z},{default:S(()=>[W(A(d.name),1)]),_:2},1024))),128))]),_:1})])):Y("",!0),x("div",ye,[(u(!0),p(q,null,P(f(h),(d,z)=>(u(),p("div",{onDblclick:$=>R(z,d),onContextmenu:V(_,["prevent","stop"]),class:"pages-list-files-item",key:z},[x("i",{"data-fileid":d.fileid,"data-filename":d.filename,"data-filesuffix":d.suffix||d.filesuffix,class:T(["iconfont",d.icon]),style:B({color:O(d.suffix,d.type)})},null,14,we),d.changeflag?(u(),U(K,{key:1,ref_for:!0,ref_key:"inputRef",ref:N,onBlur:o,onKeydown:Q(a,["enter"]),modelValue:f(e),"onUpdate:modelValue":s[0]||(s[0]=$=>Z(e)?e.value=$:e=$)},null,8,["onKeydown","modelValue"])):(u(),p(q,{key:0},[d.type==="folder"?(u(),p("span",{key:0,onDblclick:V($=>t(d),["stop"])},A(d.foldername),41,ke)):(u(),p("span",{key:1,onDblclick:V($=>t(d),["stop"])},A(d.filename+"."+d.suffix),41,ve))],64))],40,xe))),128))])])],40,_e)}}},Ne=L(Ce,[["__scopeId","data-v-4d50e03e"]]);export{Ne as default};
